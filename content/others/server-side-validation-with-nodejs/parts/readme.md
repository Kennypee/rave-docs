# Server Side Validation of Payments with NodeJS

Itâ€™s equally important to verify that payments received from customers are successful with Rave before giving value to your customers. Although Rave inline does quite a good job of verifying the payment from the client side, we strongly recommend that you still perform a server side verification to further enhance and authenticate your payment flow. This section will guide you on how to properly validate transactions using NodeJS. Node JS is an open-source, cross-platform JavaScript run-time environment that executes JavaScript code server-side.

## Check out the important criteria to observe when validating the payment on the server side:

1. Verify the transaction reference.
2. Verify the status of the transaction to be a success.
3. Verify that a charge response `chargeResponse` found in `response.data.flwMeta` has the value `00` or `0`.
4. Verify that the currency is the expected currency to accept payments in.
5. Most importantly verify the stipulated amount paid to be equal to the amount of value given.


> CAUTION : On Rave it is advised your complete a status check for every transaction using the unique transaction reference (`flwRef`) generated by the gateway. Should it be absolutely necessary you use your own unique transaction reference to perform a status check, you must ensure that your transaction reference is unique for every transaction.

**Below is a sample code of how to implement server side validation using Node JS:**

```

const express = require("express");
const bodyParser = require("body-parser");
const multipart = require("connect-multiparty");
// unirest is an http request library so any other preferred library can be used.
const unirest = require("unirest");

const PORT = process.env.PORT || 3128;

let multipartMiddleware = multipart();

const app = express();
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));

app.post("/verifyPayment", multipartMiddleware, function(req, res) {
  var payload = {
    SECKEY: "FLWSECK-d16b95d7b3ae47f5c43bd63b609ee8eb-X",
    flw_ref: req.body.flw_ref
  };

  // please make sure to change this to production url when you go live
  var server_url =
    "http://flw-pms-dev.eu-west-1.elasticbeanstalk.com/flwv3-pug/getpaidx/api/verify";

  unirest
    .post(server_url)
    .headers({ "Content-Type": "application/json" })
    .send(payload)
    .end(function(response) {
      //check status is success.
      if (response.body.status === "success") {
        if (response.body.data.amount === req.body.amount) {
          console.log("Payment successful");
          return res.json({
            status: 200,
            verified: true,
            message: "Payment Verified"
          });
        } else {
          return res.json({
            status: 200,
            verified: false,
            message: "Payment validation failed"
          });
        }
      }
    });
});

app.listen(PORT, function(){
    console.log(`Server started on locahost:${PORT}`);
});
```
